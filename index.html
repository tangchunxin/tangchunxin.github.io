<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>黄溜溜@PHP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="PHP">
<meta name="keywords" content="PHP">
<meta property="og:type" content="website">
<meta property="og:title" content="黄溜溜@PHP">
<meta property="og:url" content="https://github.com/tangchunxin/tangchunxin.github.io/index.html">
<meta property="og:site_name" content="黄溜溜@PHP">
<meta property="og:description" content="PHP">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="黄溜溜@PHP">
<meta name="twitter:description" content="PHP">
  
    <link rel="alternate" href="/atom.xml" title="黄溜溜@PHP" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">黄溜溜@PHP</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">一个小小的PHP</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://github.com/tangchunxin/tangchunxin.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-git常用命令" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/17/git常用命令/" class="article-date">
  <time datetime="2018-08-17T06:08:16.000Z" itemprop="datePublished">2018-08-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/17/git常用命令/">git常用命令</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="git-常用命令"><a href="#git-常用命令" class="headerlink" title="git 常用命令"></a>git 常用命令</h2><ul>
<li>git config –global user.name “tangchunxin”</li>
<li>git config –global user.email “<a href="mailto:tangchunxin@p2peye.com" target="_blank" rel="noopener">tangchunxin@p2peye.com</a>“</li>
<li>git config –global credential.helper store</li>
</ul>
<h4 id="git强制覆盖："><a href="#git强制覆盖：" class="headerlink" title="git强制覆盖："></a>git强制覆盖：</h4><ul>
<li>git fetch –all</li>
<li>git reset –hard origin/master</li>
<li>git pull</li>
</ul>
<ul>
<li>git stash  //将本地修改临时暂存起来</li>
<li>git stash pop //从暂存区还原</li>
<li>git stash list  //暂存区列表</li>
<li><p>git stash pop stash@{0} //从暂存区还原</p>
</li>
<li><p>git status</p>
</li>
<li>git add a.php   //提交到本地暂存区</li>
<li>git commit -m “提交a.php”  //提交到本地仓库</li>
<li>git push origin   //推送到远程</li>
<li>git branch -a  //查看远程分支状态</li>
<li>git branch dev  //创建分支</li>
<li>git checkout dev  //切分支</li>
<li>git checkout -b  dev  //创建并切分支</li>
<li></li>
<li>git push origin dev  将本地新建的分支 推到远程</li>
<li>git merge dev  把dev的代码 合并到当前分支</li>
<li>git log –oneline</li>
<li>git diff  //工作区 和暂存区</li>
<li>git diff –cached  //暂存区和历史版本</li>
<li>git diff master   //工作去和历史版本</li>
<li></li>
<li>git diff  946de  go.txt</li>
<li></li>
</ul>
<ul>
<li>git checkout – go.txt  撤销本地的修改</li>
<li>git reset HEAD a.php   从暂存区撤回到 本地</li>
</ul>
<p>假设远端库名是 origin，你要比较的本地分支为 test，远端分支就是 xxx</p>
<p>本地分支的话，直接git diff branchA branchB，而远程分支的话，git diff branchA remoteB/branchB，区别就是远程分支前面要加上remote名称。</p>
<ul>
<li>git reset –hard HEAD^  从本地库回退版本,本地修改都会被撤销</li>
<li>git reset –mixed HEAD^  从本地仓库撤回代码 ,本地修改保存</li>
<li>git reset –soft HEAD^  从本地仓库撤回代码,本地修改保存,暂存区也保存</li>
</ul>
<h4 id="问题1-在dev3分支-pull-master分支代码后-貌似dev3分支-失去了当前分支的追踪信息-因为重新找到追踪信息-git-branch-–set-upstream-to-origin-dev3"><a href="#问题1-在dev3分支-pull-master分支代码后-貌似dev3分支-失去了当前分支的追踪信息-因为重新找到追踪信息-git-branch-–set-upstream-to-origin-dev3" class="headerlink" title="问题1.在dev3分支  pull master分支代码后,貌似dev3分支,失去了当前分支的追踪信息,因为重新找到追踪信息 git branch –set-upstream-to origin dev3"></a>问题1.在dev3分支  pull master分支代码后,貌似dev3分支,失去了当前分支的追踪信息,因为重新找到追踪信息 git branch –set-upstream-to origin dev3</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">There is no tracking information for the current branch.</span><br><span class="line">Please specify which branch you want to merge with.</span><br><span class="line">See git-pull(1) for details.</span><br><span class="line"></span><br><span class="line">    git pull &lt;remote&gt; &lt;branch&gt;</span><br><span class="line"></span><br><span class="line">If you wish to set tracking information for this branch you can do so with:</span><br><span class="line"></span><br><span class="line">    git branch --set-upstream-to=origin/&lt;branch&gt; dev3</span><br></pre></td></tr></table></figure>
<ul>
<li>git push -u  加了参数-u后，以后即可直接用git push 代替git push origin master</li>
<li>git push –set-upstream origin dev3</li>
</ul>
<ul>
<li>git push origin dev3 –force</li>
<li></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Unable to create &apos;.git/index.lock&apos;: File exists</span><br><span class="line">2014年03月03日 14:10:27</span><br><span class="line">阅读数：5159</span><br><span class="line">Git – fatal: Unable to create ‘/.git/index.lock’: File exists.</span><br><span class="line">fatal: Unable to create ‘/path/my_proj/.git/index.lock’: File exists.</span><br><span class="line">If no other git process is currently running, this probably means a</span><br><span class="line">git process crashed in this repository earlier. Make sure no other git</span><br><span class="line">process is running and remove the file manually to continue.</span><br><span class="line">可以试着删除 index.lock</span><br><span class="line">rm -f ./.git/index.lock</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/08/17/git常用命令/" data-id="cjkxlf61k000blsd6fij0gs4b" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-es搜索-must-should联合查询" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/17/es搜索-must-should联合查询/" class="article-date">
  <time datetime="2018-08-17T04:53:44.000Z" itemprop="datePublished">2018-08-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/17/es搜索-must-should联合查询/">es搜索 must should联合查询</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://www.cnblogs.com/pilihaotian/p/5830754.html" target="_blank" rel="noopener">https://www.cnblogs.com/pilihaotian/p/5830754.html</a></p>
<ul>
<li>我要查询的组合条件是b=82 || （b=0 &amp;&amp; a = 0） || （b=0 &amp;&amp; a=100） ，es5.0这个must和should的Java代码怎么写？</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;query&quot;: &#123;</span><br><span class="line">   &quot;bool&quot;: &#123;</span><br><span class="line">     &quot;should&quot;: [</span><br><span class="line">       &#123;&quot;bool&quot;: &#123;</span><br><span class="line">         &quot;must&quot;: [</span><br><span class="line">           &#123;&#125;</span><br><span class="line">         ]</span><br><span class="line">       &#125;</span><br><span class="line">       &#125;,</span><br><span class="line">       &#123;&quot;bool&quot;: &#123;</span><br><span class="line">         &quot;must&quot;: [</span><br><span class="line">           &#123;&#125;</span><br><span class="line">         ]</span><br><span class="line">       &#125;&#125;</span><br><span class="line">     ]</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>must和should查询的组合条件是is_black=2 &amp;&amp; （black_type= 10 ||  black_type = 9 || operating_state == 8)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">2018-08-15 18:20:59::[INFO]    array (</span><br><span class="line">  &apos;index&apos; =&gt; &apos;platform&apos;,</span><br><span class="line">  &apos;type&apos; =&gt; &apos;info&apos;,</span><br><span class="line">  &apos;sort&apos; =&gt; </span><br><span class="line">  array (</span><br><span class="line">    0 =&gt; &apos;black_time:desc&apos;,</span><br><span class="line">  ),</span><br><span class="line">  &apos;size&apos; =&gt; 30,</span><br><span class="line">  &apos;from&apos; =&gt; 0,</span><br><span class="line">  &apos;body&apos; =&gt; </span><br><span class="line">  array (</span><br><span class="line">    &apos;query&apos; =&gt; </span><br><span class="line">    array (</span><br><span class="line">      &apos;bool&apos; =&gt; </span><br><span class="line">      array (</span><br><span class="line">        &apos;must&apos; =&gt; </span><br><span class="line">        array (</span><br><span class="line">          0 =&gt; </span><br><span class="line">          array (</span><br><span class="line">            &apos;bool&apos; =&gt; </span><br><span class="line">            array (</span><br><span class="line">              &apos;should&apos; =&gt; </span><br><span class="line">              array (</span><br><span class="line">                0 =&gt; </span><br><span class="line">                array (</span><br><span class="line">                  &apos;match&apos; =&gt; </span><br><span class="line">                  array (</span><br><span class="line">                    &apos;black_type&apos; =&gt; 10,</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">                1 =&gt; </span><br><span class="line">                array (</span><br><span class="line">                  &apos;match&apos; =&gt; </span><br><span class="line">                  array (</span><br><span class="line">                    &apos;black_type&apos; =&gt; 9,</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">                2 =&gt; </span><br><span class="line">                array (</span><br><span class="line">                  &apos;match&apos; =&gt; </span><br><span class="line">                  array (</span><br><span class="line">                    &apos;operating_state&apos; =&gt; 8,</span><br><span class="line">                  ),</span><br><span class="line">                ),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          1 =&gt; </span><br><span class="line">          array (</span><br><span class="line">            0 =&gt; </span><br><span class="line">            array (</span><br><span class="line">              &apos;term&apos; =&gt; </span><br><span class="line">              array (</span><br><span class="line">                &apos;is_black&apos; =&gt; 2,</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">  ),</span><br><span class="line">)::</span><br><span class="line">2018-08-15 18:20:59::[INFO]    array (</span><br><span class="line">  &apos;index&apos; =&gt; &apos;platform&apos;,</span><br><span class="line">  &apos;type&apos; =&gt; &apos;info&apos;,</span><br><span class="line">  &apos;sort&apos; =&gt; </span><br><span class="line">  array (</span><br><span class="line">    0 =&gt; &apos;black_time:desc&apos;,</span><br><span class="line">  ),</span><br><span class="line">  &apos;size&apos; =&gt; 30,</span><br><span class="line">  &apos;from&apos; =&gt; 0,</span><br><span class="line">  &apos;body&apos; =&gt; </span><br><span class="line">  array (</span><br><span class="line">    &apos;query&apos; =&gt; </span><br><span class="line">    array (</span><br><span class="line">      &apos;bool&apos; =&gt; </span><br><span class="line">      array (</span><br><span class="line">        &apos;must&apos; =&gt; </span><br><span class="line">        array (</span><br><span class="line">          0 =&gt; </span><br><span class="line">          array (</span><br><span class="line">            &apos;term&apos; =&gt; </span><br><span class="line">            array (</span><br><span class="line">              &apos;is_black&apos; =&gt; 1,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">        &apos;must_not&apos; =&gt; </span><br><span class="line">        array (</span><br><span class="line">          0 =&gt; </span><br><span class="line">          array (</span><br><span class="line">            0 =&gt; </span><br><span class="line">            array (</span><br><span class="line">              &apos;term&apos; =&gt; </span><br><span class="line">              array (</span><br><span class="line">                &apos;operating_state_combination&apos; =&gt; 1,</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">  ),</span><br><span class="line">)::</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/08/17/es搜索-must-should联合查询/" data-id="cjkxlf61e0007lsd6o1o1uo8x" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/17/hello-world/" class="article-date">
  <time datetime="2018-08-17T01:56:53.626Z" itemprop="datePublished">2018-08-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/17/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/08/17/hello-world/" data-id="cjkxlf61q000dlsd6j5znzypu" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-git-start" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/08/16/git-start/" class="article-date">
  <time datetime="2018-08-16T15:31:23.000Z" itemprop="datePublished">2018-08-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/08/16/git-start/">git start</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/08/16/git-start/" data-id="cjkxlf61i000alsd65j6k3d73" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-正则-手机号中间4位变成" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/20/正则-手机号中间4位变成/" class="article-date">
  <time datetime="2018-05-20T07:59:56.000Z" itemprop="datePublished">2018-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/20/正则-手机号中间4位变成/">正则 手机号中间4位变成*</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>例子<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$tel=&apos;16601162743&apos;;</span><br><span class="line"></span><br><span class="line">$tel = preg_replace(&apos;/(\d&#123;3&#125;)\d&#123;4&#125;(\d&#123;4&#125;)/&apos;, &apos;$1****$2&apos;, $tel);</span><br><span class="line">var_dump($tel);</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/05/20/正则-手机号中间4位变成/" data-id="cjkxlf624000plsd6ghno2pw1" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-PHP-curl-远程抓取图片" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/20/PHP-curl-远程抓取图片/" class="article-date">
  <time datetime="2018-05-20T07:54:23.000Z" itemprop="datePublished">2018-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/20/PHP-curl-远程抓取图片/">PHP_curl 远程抓取图片</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="远程图片抓取。"><a href="#远程图片抓取。" class="headerlink" title="远程图片抓取。"></a>远程图片抓取。</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">function GrabImage($url,$filename=&quot;&quot;) &#123;</span><br><span class="line">    if($url==&quot;&quot;):return false;endif;</span><br><span class="line"></span><br><span class="line">    if($filename==&quot;&quot;) &#123;</span><br><span class="line">        $ext=strrchr($url,&quot;.&quot;);</span><br><span class="line">        if($ext!=&quot;.gif&quot; &amp;&amp; $ext!=&quot;.jpg&quot;):return false;endif;</span><br><span class="line">        $filename=date(&quot;dMYHis&quot;).$ext;</span><br><span class="line">    &#125;</span><br><span class="line">/*</span><br><span class="line">    $img = file_get_contents($url);</span><br><span class="line">    if(!$img)&#123;</span><br><span class="line">    	return false;</span><br><span class="line">    &#125;</span><br><span class="line">    file_put_contents($filename,$img);</span><br><span class="line">*/</span><br><span class="line">    $ch=curl_init();</span><br><span class="line">    $timeout=5;</span><br><span class="line">    curl_setopt($ch,CURLOPT_URL,$url);</span><br><span class="line">    curl_setopt($ch,CURLOPT_RETURNTRANSFER,1);</span><br><span class="line">    curl_setopt($ch,CURLOPT_CONNECTTIMEOUT,$timeout);</span><br><span class="line">    $img=curl_exec($ch);</span><br><span class="line">    curl_close($ch);</span><br><span class="line"></span><br><span class="line">//    ob_start();</span><br><span class="line">//    $file = readfile($url);</span><br><span class="line">//    $img = ob_get_contents();</span><br><span class="line">//    ob_end_clean();</span><br><span class="line">//    $size = strlen($img);</span><br><span class="line">    if(!$img) return false;</span><br><span class="line"></span><br><span class="line">    $fp2=@fopen($filename, &quot;a&quot;);</span><br><span class="line">    fwrite($fp2,$img);</span><br><span class="line">    fclose($fp2);</span><br><span class="line"></span><br><span class="line">    return $filename;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>如果没有配https<br>D:\work\sites\img_p2peye\upload.php 70行中https变成http<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">echo json_encode ( array (</span><br><span class="line">		&quot;code&quot; =&gt; 200,</span><br><span class="line">		&quot;url&quot; =&gt; &quot;https://img.p2peye.com&#123;$path&#125;/$res&quot;,</span><br><span class="line">		&quot;file&quot; =&gt; $path . &quot;/&quot; .$res,</span><br><span class="line">		&quot;name&quot; =&gt; $res,</span><br><span class="line">		&quot;file_name&quot; =&gt; $path . &apos;/&apos;</span><br><span class="line">) );</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>变成<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">echo json_encode ( array (</span><br><span class="line">		&quot;code&quot; =&gt; 200,</span><br><span class="line">		&quot;url&quot; =&gt; &quot;http://img.p2peye.com&#123;$path&#125;/$res&quot;,</span><br><span class="line">		&quot;file&quot; =&gt; $path . &quot;/&quot; .$res,</span><br><span class="line">		&quot;name&quot; =&gt; $res,</span><br><span class="line">		&quot;file_name&quot; =&gt; $path . &apos;/&apos;</span><br><span class="line">) );</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/05/20/PHP-curl-远程抓取图片/" data-id="cjkxlf6120001lsd6misq20fk" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="w-php-导出-excel-简单方式" class="article article-type-w" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/09/php-导出-excel-简单方式/" class="article-date">
  <time datetime="2018-05-09T14:02:08.000Z" itemprop="datePublished">2018-05-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/09/php-导出-excel-简单方式/">php 导出 excel 简单方式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="php-导出-excel-简单方式"><a href="#php-导出-excel-简单方式" class="headerlink" title="php 导出 excel  简单方式"></a>php 导出 excel  简单方式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$pname = &quot;ces&quot;;</span><br><span class="line">$url = &quot;aaa&quot;;</span><br><span class="line">$icp = &quot;icl&quot;;</span><br><span class="line">$str = &quot;平台ID\t平台名称\t首页网址\t\n&quot;;</span><br><span class="line">$str = iconv(&apos;utf-8&apos;,&apos;gbk&apos;,$str);</span><br><span class="line">$str .= trim($pname).&quot;\t&quot;.trim($url).&quot;\t&quot;.trim($icp).&quot;\t\n&quot;;</span><br><span class="line"></span><br><span class="line"> $filename = &apos;平台档案导出&apos;.date(&apos;Ymd&apos;).&apos;.xls&apos;;</span><br><span class="line"></span><br><span class="line"> header(&quot;Cache-Control: must-revalidate, post-check=0, pre-check=0&quot;);</span><br><span class="line"> header(&quot;Content-Type: application/vnd.ms-execl&quot;);</span><br><span class="line"> header(&quot;Content-Type: application/force-download&quot;);</span><br><span class="line"> header(&quot;Content-Type: application/download&quot;);</span><br><span class="line"> header(&quot;Content-Disposition: attachment; filename=&quot;.$filename);</span><br><span class="line"> header(&quot;Content-Transfer-Encoding: binary&quot;);</span><br><span class="line"> header(&quot;Pragma: no-cache&quot;);</span><br><span class="line"> header(&quot;Expires: 0&quot;);</span><br><span class="line"></span><br><span class="line"> echo $str;</span><br></pre></td></tr></table></figure>
<p> header部分可修改为<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> header(&apos;Content-Description: File Transfer&apos;);</span><br><span class="line">header(&apos;Content-Type: application/vnd.ms-excel&apos;);</span><br><span class="line">header(&apos;Content-Disposition: attachment; filename=&quot;&apos;. $filename .&apos;&quot;&apos;);</span><br><span class="line">header(&apos;Expires: 0&apos;);</span><br><span class="line">header(&apos;Cache-Control: must-revalidate&apos;);</span><br><span class="line">header(&apos;Pragma: public&apos;);</span><br><span class="line">$fp = fopen(&apos;php://output&apos;, &apos;a&apos;);//打开output流</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//mb_convert_variables(&apos;GBK&apos;, &apos;UTF-8&apos;, $str);</span><br><span class="line">fputs($fp, $str);//将数据格式化为CSV格式并写入到output流中</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">unset($str);//释放变量的内存</span><br><span class="line">ob_flush();</span><br><span class="line">flush();//必须同时使用 ob_flush() 和flush() 函数来刷新输出缓冲。</span><br><span class="line">fclose($fp);</span><br><span class="line"></span><br><span class="line">exit;</span><br></pre></td></tr></table></figure></p>
<h4 id="php-导出-txt-简单方式"><a href="#php-导出-txt-简单方式" class="headerlink" title="php 导出 txt  简单方式`"></a>php 导出 txt  简单方式`</h4> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//下载文件名</span><br><span class="line"> $file_name = $name.date(&apos;Y.m.d.H-i-s&apos;,time());</span><br><span class="line"> $filename = iconv(&apos;UTF-8&apos;, &apos;GBK&apos;, $file_name);</span><br><span class="line"> header(&apos;Content-Type: text/plain&apos;);</span><br><span class="line"> header ( &apos;Content-Disposition: attachment;filename=&quot;&apos; . $filename . &apos;.txt&quot;&apos; ); </span><br><span class="line"> header ( &apos;Cache-Control: max-age=0&apos; );</span><br><span class="line"> echo &quot;我是.txt的内容&quot;;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/05/09/php-导出-excel-简单方式/" data-id="cjkxlf622000nlsd6e07ek2il" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hostory-go-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/09/hostory-go-1/" class="article-date">
  <time datetime="2018-05-09T14:00:20.000Z" itemprop="datePublished">2018-05-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/09/hostory-go-1/">hostory.go(-1)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="hostory-go-1"><a href="#hostory-go-1" class="headerlink" title="hostory.go(-1)"></a>hostory.go(-1)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (! $platform[&apos;pprovince&apos;]) &#123;</span><br><span class="line">      echo &quot;&lt;script&gt;alert(&apos;省份名称不能为空&apos;);history.go(-1);&lt;/script&gt;&quot;;</span><br><span class="line">      exit();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="两个方法的区别"><a href="#两个方法的区别" class="headerlink" title="两个方法的区别"></a>两个方法的区别</h4><p>既然history.back(-1)和history.go(-1)都是返回之前页面，但是方法不同，所以肯定是有区别的：</p>
<ul>
<li>history.back(-1)//直接返回当前页的上一页，数据全部消息，是个新页面</li>
<li><p>history.go(-1)//也是返回当前页的上一页，不过表单里的数据全部还在</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>返回、前进页面的方法下面总结一下：</p>
</li>
<li><p>window.location.reload() //刷新</p>
</li>
<li>window.history.go(1) //前进</li>
<li>window.history.go(-1) //后退</li>
<li>window.history.forward() //前进</li>
<li>window.history.back() 后退+刷新</li>
<li></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/05/09/hostory-go-1/" data-id="cjkxlf61s000flsd6wlpqbgwv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-PHP中跳转js" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/09/PHP中跳转js/" class="article-date">
  <time datetime="2018-05-09T13:59:10.000Z" itemprop="datePublished">2018-05-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/09/PHP中跳转js/">PHP中跳转js</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="PHP中跳转-js"><a href="#PHP中跳转-js" class="headerlink" title="PHP中跳转  js"></a>PHP中跳转  js</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo &apos;&lt;script language=&quot;javascript&quot;&gt;</span><br><span class="line">alert(&quot;添加完成，同步成功&quot;);</span><br><span class="line">window.location.href=&quot;http://ymis.p2peye.com/platform/index&quot;;</span><br><span class="line"> &lt;/script&gt;&apos;;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/05/09/PHP中跳转js/" data-id="cjkxlf6170003lsd62zme9z8i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-正则获取主域名" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/09/正则获取主域名/" class="article-date">
  <time datetime="2018-05-09T13:56:27.000Z" itemprop="datePublished">2018-05-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/09/正则获取主域名/">正则获取主域名</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="域名匹配"><a href="#域名匹配" class="headerlink" title="域名匹配"></a>域名匹配</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">preg_match(&apos;/[\w][\w-]*\.(?:com\.cn|net\.cn|gov\.cn|ac\.cn|com|cn|co|net|org|gov|info|xyz|name|mobi|wang|top|xin|shop|ltd|cc|club|vip|ink|fun|online|tech|store|red|pro|group|work|ren|biz|site|tv|wiki|design|live|pub)(\/|$)/isU&apos;</span><br><span class="line">, &quot;www.baidu.info/index.php&quot;, $domain);</span><br><span class="line"></span><br><span class="line">$domain = !empty($domain[0]) ? $domain[0] : &apos;&apos;;</span><br><span class="line"></span><br><span class="line">$aa= str_replace(strstr($domain, &apos;.&apos;), &apos;&apos;, $domain);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var_dump($aa);</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/05/09/正则获取主域名/" data-id="cjkxlf625000qlsd6whbctqpb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Discuz开发之主题表pre-forum-thread的displayorder字段含义" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/09/Discuz开发之主题表pre-forum-thread的displayorder字段含义/" class="article-date">
  <time datetime="2018-05-09T13:54:58.000Z" itemprop="datePublished">2018-05-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/05/09/Discuz开发之主题表pre-forum-thread的displayorder字段含义/">Discuz开发之主题表pre_forum_thread的displayorder字段含义</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Discuz开发之主题表pre-forum-thread的displayorder字段含义"><a href="#Discuz开发之主题表pre-forum-thread的displayorder字段含义" class="headerlink" title="Discuz开发之主题表pre_forum_thread的displayorder字段含义"></a>Discuz开发之主题表pre_forum_thread的displayorder字段含义</h2><h4 id="Discuz-二次开发和插件开发中经常涉及对主题表的操作，本文就介绍一下pre-forum-thread的displayorder字段含义："><a href="#Discuz-二次开发和插件开发中经常涉及对主题表的操作，本文就介绍一下pre-forum-thread的displayorder字段含义：" class="headerlink" title="Discuz!二次开发和插件开发中经常涉及对主题表的操作，本文就介绍一下pre_forum_thread的displayorder字段含义："></a>Discuz!二次开发和插件开发中经常涉及对主题表的操作，本文就介绍一下pre_forum_thread的displayorder字段含义：</h4><p>displayorder取值范围为：4,3,2,1,0，-1，-2，-3，-4，他们的含义如下：</p>
<ul>
<li><p>displayorder=4 ：多版块置顶功能可让一个主题在任意多个版块 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">只在指定的板块显示主题</span><br><span class="line"></span><br><span class="line">需要在后台-内容-主题-板块/群组指定来进行操作</span><br><span class="line"></span><br><span class="line">以下三种置顶可以在版主管理的浮动窗口操作</span><br></pre></td></tr></table></figure>
</li>
<li><p>displayorder=3 ：全局置顶 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">全部专区，每个板块都可已看的到</span><br></pre></td></tr></table></figure>
</li>
<li><p>displayorder=2 ：分类置顶  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">本专区的所有板块都可以看到该帖</span><br></pre></td></tr></table></figure>
</li>
<li><p>dispalyorder=1 ：本版置顶  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">只有本板块在置顶区看得到，该板块子版块和其他都看不到</span><br></pre></td></tr></table></figure>
</li>
<li><p>displayorder=0 ：普通贴</p>
</li>
</ul>
<h4 id="在前后台的版主管理操作中，可以进行删除主题的操作，如果此版块设置启用了回收站，那么主题被删除时被放入回收站，displayorder为-1，否则直接从数据库中删除；"><a href="#在前后台的版主管理操作中，可以进行删除主题的操作，如果此版块设置启用了回收站，那么主题被删除时被放入回收站，displayorder为-1，否则直接从数据库中删除；" class="headerlink" title="在前后台的版主管理操作中，可以进行删除主题的操作，如果此版块设置启用了回收站，那么主题被删除时被放入回收站，displayorder为-1，否则直接从数据库中删除；"></a>在前后台的版主管理操作中，可以进行删除主题的操作，如果此版块设置启用了回收站，那么主题被删除时被放入回收站，displayorder为-1，否则直接从数据库中删除；</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">版块开启回收站：后台-论坛-版块管理-帖子选项</span><br></pre></td></tr></table></figure>
<ul>
<li><p>displayorder=-1 ：回收站</p>
</li>
<li><p>displayorder=-2 ：审核中</p>
</li>
<li><p>displayorder=-3 ：审核忽略</p>
</li>
<li><p>displayorder=-4 ：草稿</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/05/09/Discuz开发之主题表pre-forum-thread的displayorder字段含义/" data-id="cjkxlf6150002lsd6pqn2fika" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-linux-Nginx-URL重写（rewrite）介绍" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/28/linux-Nginx-URL重写（rewrite）介绍/" class="article-date">
  <time datetime="2018-04-28T13:36:29.000Z" itemprop="datePublished">2018-04-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/28/linux-Nginx-URL重写（rewrite）介绍/">linux Nginx URL重写（rewrite）介绍</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Nginx-URL重写（rewrite）介绍"><a href="#Nginx-URL重写（rewrite）介绍" class="headerlink" title="Nginx URL重写（rewrite）介绍"></a>Nginx URL重写（rewrite）介绍</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rewrite ^([^\.]*)/([0-9]+)/([0-9]+)/([0-9]+)/([a-zA-Z0-9]+)\.(gif|jpg|jpeg)$  https://www.baidu.com last;</span><br></pre></td></tr></table></figure>
<p> 注意这里要用‘’单引号引起来，避免{}<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rewrite &apos;^/images/([a-z]&#123;2&#125;)/([a-z0-9]&#123;5&#125;)/(.*)\.(png|jpg|gif)$&apos; /data?file=$3.$4;</span><br></pre></td></tr></table></figure></p>
<pre><code>和apache等web服务软件一样，rewrite的组要功能是实现RUL地址的重定向。Nginx的rewrite功能需要PCRE软件的支持，即通过perl兼容正则表达式语句进行规则匹配的。默认参数编译nginx就会支持rewrite的模块，但是也必须要PCRE的支持
</code></pre><ul>
<li>rewrite是实现URL重写的关键指令，根据regex（正则表达式）部分内容，重定向到replacement，结尾是flag标记。</li>
</ul>
<ul>
<li><p>rewrite语法格式及参数语法说明如下:</p>
<p>  rewrite|<regex>|<replacement>|[flag]|<br>  —|:—:|:—:|:—:|<br>  |关键字|正则|替代内容|flag标记</replacement></regex></p>
</li>
</ul>
<pre><code>关键字：其中关键字error_log不能改变

正则：perl兼容正则表达式语句进行规则匹配

替代内容：将正则匹配的内容替换成replacement

flag标记：rewrite支持的flag标记
</code></pre><p>flag标记说明：</p>
<p>last  #本条规则匹配完成后，继续向下匹配新的location URI规则</p>
<p>break  #本条规则匹配完成即终止，不再匹配后面的任何规则</p>
<p>redirect  #返回302临时重定向，浏览器地址会显示跳转后的URL地址</p>
<p>permanent  #返回301永久重定向，浏览器地址栏会显示跳转后的URL地址</p>
<p>rewrite参数的标签段位置：<br>server,location,if</p>
<p>例子：<br>rewrite ^/(.*) <a href="http://www.czlun.com/$1" target="_blank" rel="noopener">http://www.czlun.com/$1</a> permanent;</p>
<p>说明：                                        </p>
<p>rewrite为固定关键字，表示开始进行rewrite匹配规则</p>
<p>regex部分是 ^/(.*) ，这是一个正则表达式，匹配完整的域名和后面的路径地址</p>
<p>replacement部分是<a href="http://www.czlun.com/$1" target="_blank" rel="noopener">http://www.czlun.com/$1</a> $1，是取自regex部分()里的内容。匹配成功后跳转到的URL。</p>
<p>flag部分 permanent表示永久301重定向标记，即跳转到新的 <a href="http://www.czlun.com/$1" target="_blank" rel="noopener">http://www.czlun.com/$1</a> 地址上</p>
<p>regex 常用正则表达式说明<br>字符</p>
<p>描述</p>
<p>\</p>
<p>将后面接着的字符标记为一个特殊字符或一个原义字符或一个向后引用。如“\n”匹配一个换行符，而“\$”则匹配“$”</p>
<p>^</p>
<p>匹配输入字符串的起始位置</p>
<p>$</p>
<p>匹配输入字符串的结束位置</p>
<p>*</p>
<p>匹配前面的字符零次或多次。如“ol*”能匹配“o”及“ol”、“oll”</p>
<p>+</p>
<p>匹配前面的字符一次或多次。如“ol+”能匹配“ol”及“oll”、“oll”，但不能匹配“o”</p>
<p>?</p>
<p>匹配前面的字符零次或一次，例如“do(es)?”能匹配“do”或者“does”，”?”等效于”{0,1}”</p>
<p>.</p>
<p>匹配除“\n”之外的任何单个字符，若要匹配包括“\n”在内的任意字符，请使用诸如“[.\n]”之类的模式。</p>
<p>(pattern)</p>
<p>匹配括号内pattern并可以在后面获取对应的匹配，常用$0…$9属性获取小括号中的匹配内容，要匹配圆括号字符需要(Content)</p>
<p>rewrite 企业应用场景<br>Nginx的rewrite功能在企业里应用非常广泛：</p>
<p>u 可以调整用户浏览的URL，看起来更规范，合乎开发及产品人员的需求。</p>
<p>u 为了让搜索引擎搜录网站内容及用户体验更好，企业会将动态URL地址伪装成静态地址提供服务。</p>
<p>u 网址换新域名后，让旧的访问跳转到新的域名上。例如，访问京东的360buy.com会跳转到jd.com</p>
<p>u 根据特殊变量、目录、客户端的信息进行URL调整等</p>
<p>Nginx配置rewrite过程介绍<br>（1）创建rewrite语句<br>vi conf/vhost/<a href="http://www.abc.com.conf" target="_blank" rel="noopener">www.abc.com.conf</a></p>
<p>#vi编辑虚拟主机配置文件</p>
<p>文件内容</p>
<p>server {</p>
<pre><code>listen 80;

server_name abc.com;

rewrite ^/(.*) http://www.abc.com/$1 permanent;
</code></pre><p>}</p>
<p>server {</p>
<pre><code>listen 80;

server_name www.abc.com;

location / {

        root /data/www/www;

        index index.html index.htm;

}

error_log    logs/error_www.abc.com.log error;

access_log    logs/access_www.abc.com.log    main;
</code></pre><p>}</p>
<p>或者</p>
<p>server {</p>
<pre><code>listen 80;

server_name abc.com www.abc.com;

if ( $host != &apos;www.abc.com&apos;  ) {

        rewrite ^/(.*) http://www.abc.com/$1 permanent;

}

location / {

        root /data/www/www;

        index index.html index.htm;

}

error_log    logs/error_www.abc.com.log error;

access_log    logs/access_www.abc.com.log    main;
</code></pre><p>}</p>
<p>（2）重启服务<br>确认无误便可重启，操作如下：</p>
<p>nginx -t</p>
<p>#结果显示ok和success没问题便可重启</p>
<p>nginx -s reload</p>
<p>（3）查看跳转效果<br>打开浏览器访问abc.com</p>
<p>页面打开后，URL地址栏的abc.com变成了<a href="http://www.abc.com说明URL重写成功。" target="_blank" rel="noopener">www.abc.com说明URL重写成功。</a></p>
<h2 id="nginx-location-rewrite匹配顺序"><a href="#nginx-location-rewrite匹配顺序" class="headerlink" title="nginx location rewrite匹配顺序"></a>nginx location rewrite匹配顺序</h2><p> Rewrite（ URL 重写）指令可以出现在 server{} 下，也可以出现在 location{} 下，它们之间是有区别的！对于出现在 server{} 下的 rewrite 指令，它的执行会在 location 匹配之前；对于出现在 location{} 下的 rewrite 指令，它的执行当然是在 location 匹配之后，但是由于 rewrite 导致 HTTP 请求的 URI 发生了变化，所以 location{} 下的 rewrite 后的 URI 又需要重新匹配 location ，就好比一个新的 HTTP 请求一样（注意由 location{} 内的 rewrite 导致的这样的循环匹配最多不超过 10 次，否则 nginx 会报 500 错误）。总的来说，如果 server{} 和 location{} 下都有 rewrite ，依然是先执行 server{} ，然后进行 location 匹配，如果被匹配的 location{} 之内还有 rewrite 指令，那么继续执行 rewrite ，同时因为 location{} 内的 rewrite 改变了 URI ，那么重写后的结果 URI 需要当做一个新的请求，重新匹配 location （应该也包括重新执行 server{} 下的 rewrite 吧）。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/04/28/linux-Nginx-URL重写（rewrite）介绍/" data-id="cjkxlf61t000glsd6pg8ds5ss" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/08/17/git常用命令/">git常用命令</a>
          </li>
        
          <li>
            <a href="/2018/08/17/es搜索-must-should联合查询/">es搜索 must should联合查询</a>
          </li>
        
          <li>
            <a href="/2018/08/17/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2018/08/16/git-start/">git start</a>
          </li>
        
          <li>
            <a href="/2018/05/20/正则-手机号中间4位变成/">正则 手机号中间4位变成*</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Tangchunxin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>