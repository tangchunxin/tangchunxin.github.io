<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>黄溜溜@PHP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="PHP">
<meta name="keywords" content="PHP">
<meta property="og:type" content="website">
<meta property="og:title" content="黄溜溜@PHP">
<meta property="og:url" content="https://github.com/tangchunxin/tangchunxin.github.io/page/2/index.html">
<meta property="og:site_name" content="黄溜溜@PHP">
<meta property="og:description" content="PHP">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="黄溜溜@PHP">
<meta name="twitter:description" content="PHP">
  
    <link rel="alternate" href="/atom.xml" title="黄溜溜@PHP" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">黄溜溜@PHP</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">一个小小的PHP</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://github.com/tangchunxin/tangchunxin.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-linux-nginx设置禁止通过ip访问服务器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/28/linux-nginx设置禁止通过ip访问服务器/" class="article-date">
  <time datetime="2018-04-28T13:35:28.000Z" itemprop="datePublished">2018-04-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/28/linux-nginx设置禁止通过ip访问服务器/">linux nginx设置禁止通过ip访问服务器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="为了避免别人把未备案的域名解析到自己的服务器ip而导致服务器被断网，需要在nginx上设置禁止通过ip访问服务器，只能通过域名访问。"><a href="#为了避免别人把未备案的域名解析到自己的服务器ip而导致服务器被断网，需要在nginx上设置禁止通过ip访问服务器，只能通过域名访问。" class="headerlink" title="为了避免别人把未备案的域名解析到自己的服务器ip而导致服务器被断网，需要在nginx上设置禁止通过ip访问服务器，只能通过域名访问。"></a>为了避免别人把未备案的域名解析到自己的服务器ip而导致服务器被断网，需要在nginx上设置禁止通过ip访问服务器，只能通过域名访问。</h4><ul>
<li>最关键的一点是，在server的设置里面添加这么一行：  </li>
<li>Listen 80 default;  </li>
<li>后面的default参数表示这个是默认的虚拟主机。  </li>
<li><p>例如：别人如果通过ip或者未知域名访问你的网站的时候，你希望禁止显示任何有效内容，可以给他返回404。具体如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server &#123;  </span><br><span class="line">       listen 80 default;</span><br><span class="line">       listen [::]:80 default;</span><br><span class="line">       server_name _;  </span><br><span class="line">       return 404;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>当然，按照上述设置，的确不能让别人通过ip访问服务器了，但是还应该开放一个或多个真实的希望被访问的域名配置，设置如下：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//增加一个server段</span><br><span class="line">server &#123;  </span><br><span class="line">       listen 80 default;</span><br><span class="line">       listen [::]:80 default;</span><br><span class="line">       server_name _;  </span><br><span class="line">       return 404;  </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">//将原有的 修改为只允许某几个域名访问</span><br><span class="line">server &#123;  </span><br><span class="line">        linten 80; </span><br><span class="line">        listen [::]:80;</span><br><span class="line">        server_name www.941db.com www.aaa.com； （以世海夺宝网为例）  </span><br><span class="line">………..  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/04/28/linux-nginx设置禁止通过ip访问服务器/" data-id="cjkxlf61v000hlsd60uap5z76" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-php-header" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/28/php-header/" class="article-date">
  <time datetime="2018-04-28T13:30:57.000Z" itemprop="datePublished">2018-04-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/28/php-header/">php  header</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>header(“Location:/index.php”);//跳转到当前域名下的文件</li>
<li>header(“Location:<a href="https://www.baidu.com&quot;);//跳转到其他域名" target="_blank" rel="noopener">https://www.baidu.com&quot;);//跳转到其他域名</a></li>
<li>@header(“http/1.1 404 not found”); //跳转到404页面</li>
<li>“http://“.$_SERVER[‘SERVER_NAME’].$_SERVER[‘REQUEST_URI’];//当前请求url,例如<a href="http://www.p2peye.com/test.php?a=1" target="_blank" rel="noopener">http://www.p2peye.com/test.php?a=1</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/04/28/php-header/" data-id="cjkxlf61x000jlsd6oupt1nw5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-php-var-export" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/28/php-var-export/" class="article-date">
  <time datetime="2018-04-28T13:25:13.000Z" itemprop="datePublished">2018-04-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/28/php-var-export/">php  var_export</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>var_export() 函数返回关于传递给该函数的变量的结构信息，</p>
<p>它和 var_dump() 类似，</p>
<p>不同的是其返回的表示是合法的 PHP代码<br>var_export必须返回合法的php代码， 也就是说，<br>var_export返回的代码，可以直接当作php代码赋值个一个变量。<br>而这个变量就会取得和被var_export一样的类型的值。</p>
<p>   for example:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$var=array(&apos;1&apos;=&gt;&apos;A&apos;,&apos;2&apos;=&gt;&apos;B&apos;,&apos;3&apos;=&gt;&apos;C&apos;,&apos;4&apos;=&gt;&apos;D&apos;);</span><br><span class="line">var_export($var);</span><br><span class="line">var_dump($var);</span><br></pre></td></tr></table></figure></p>
<p>   返回结果为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array ( 1 =&gt; &apos;A&apos;, 2 =&gt; &apos;B&apos;, 3 =&gt; &apos;C&apos;, 4 =&gt; &apos;D&apos;, )</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">array (size=4)</span><br><span class="line"> 1 =&gt;  &apos;A&apos; (length=1)</span><br><span class="line"> 2 =&gt;  &apos;B&apos; (length=1)</span><br><span class="line"> 3 =&gt;  &apos;C&apos; (length=1)</span><br><span class="line"> 4 =&gt;  &apos;D&apos; (length=1)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  $var =var_export(array(&apos;a&apos;,&apos;b&apos;,array(&apos;aa&apos;,&apos;bb&apos;,&apos;cc&apos;)),TRUE)，加上TRUE后，不会再打印出来，而是给了一个变量，这样就可以直接输出; </span><br><span class="line">  </span><br><span class="line">  $arr=(array(&quot;a&quot;=&gt;1,&quot;b&quot;=&gt;2));</span><br><span class="line">  writelog(&quot;sqllog&quot;,var_export($arr,true));</span><br><span class="line">echo $var;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/04/28/php-var-export/" data-id="cjkxlf621000mlsd69mjs1eyh" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-sql通配符" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/25/sql通配符/" class="article-date">
  <time datetime="2018-04-25T13:42:47.000Z" itemprop="datePublished">2018-04-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/25/sql通配符/">sql通配符</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>在discuz_database类中的public static function query方法</li>
<li>self::checkquery($sql);在这后面加上 writelog(“sqllog”,$sql);即可看到所有SQL</li>
<li>$logdir = DISCUZ_ROOT.’./data/log/sqllog’;</li>
</ul>
<h2 id="sql通配符"><a href="#sql通配符" class="headerlink" title="sql通配符"></a>sql通配符</h2><ul>
<li>SELECT * FROM %t =&gt;查询表t开头的 例如t_common_friendlink 表</li>
<li>$sql = ‘WHERE (<code>type</code> &amp; %s &gt; 0)’  =&gt;SELECT * FROM t_common_friendlink WHERE (<code>type</code> &amp; ‘8’ &gt; 0) ORDER BY displayorder<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">二进制</span><br><span class="line"></span><br><span class="line">他使用这一个 type  能存储多个类型</span><br><span class="line"></span><br><span class="line">比如 type 是  二进制 1111  </span><br><span class="line">它和  8  4  2  1  都能位与 &gt; 0</span><br><span class="line"></span><br><span class="line">它就同时属于  1  2  4  8   这四种类型</span><br><span class="line"></span><br><span class="line">就是用每个二进制位   置为1 表示一个类型</span><br><span class="line"></span><br><span class="line">但是这个在数据库 索引不起作用 数据庞大 这样做就是崩溃了</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>在discuz_database类中的public static function query方法</li>
<li>self::checkquery($sql);在这后面加上 writelog(“sqllog”,$sql);即可看到所有SQL</li>
<li>$logdir = DISCUZ_ROOT.’./data/log/sqllog’;</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/04/25/sql通配符/" data-id="cjkxlf623000olsd61klum04v" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-defined安全判断，放于被包含脚本中" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/25/defined安全判断，放于被包含脚本中/" class="article-date">
  <time datetime="2018-04-25T13:41:13.000Z" itemprop="datePublished">2018-04-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/25/defined安全判断，放于被包含脚本中/">defined安全判断，放于被包含脚本中</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一般用于安全判断，放于被包含脚本中"><a href="#一般用于安全判断，放于被包含脚本中" class="headerlink" title="一般用于安全判断，放于被包含脚本中"></a>一般用于安全判断，放于被包含脚本中</h2><ul>
<li><p>判断：如果没有定义IN_PISCES常量，则直接退出脚本，并提示ACCESS DENIED文字</p>
</li>
<li><p>举例：</p>
</li>
</ul>
<h4 id="a-php"><a href="#a-php" class="headerlink" title="a.php"></a>a.php</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">define(&apos;IN_PISCES&apos;,1);</span><br><span class="line">include &apos;b.php&apos;;</span><br><span class="line">echo &apos;a&apos;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<h4 id="b-php"><a href="#b-php" class="headerlink" title="b.php"></a>b.php</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(!defined(&apos;IN_PISCES&apos;))&#123;</span><br><span class="line">    exit(&apos;非法访问&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="echo-‘b’"><a href="#echo-‘b’" class="headerlink" title="echo ‘b’;"></a>echo ‘b’;</h4><h4 id="这时候，你直接访问b-php是会提示非法访问的，只有访问a-php才能输出”b”。"><a href="#这时候，你直接访问b-php是会提示非法访问的，只有访问a-php才能输出”b”。" class="headerlink" title="这时候，你直接访问b.php是会提示非法访问的，只有访问a.php才能输出”b”。"></a>这时候，你直接访问b.php是会提示非法访问的，只有访问a.php才能输出”b”。</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/04/25/defined安全判断，放于被包含脚本中/" data-id="cjkxlf61b0006lsd6dkhh1vjg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-node-js安装" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/25/node-js安装/" class="article-date">
  <time datetime="2018-04-25T13:39:35.000Z" itemprop="datePublished">2018-04-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/25/node-js安装/">node.js安装</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>###　首先下载安装包</p>
<ul>
<li><a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">https://nodejs.org/en/download/</a></li>
<li>点击下载相应的zip版本</li>
</ul>
<p><img src="https://images2018.cnblogs.com/blog/1028599/201712/1028599-20171225194706650-1436753993.png" alt=""></p>
<ul>
<li><p>然后将文件夹解压到任意目录</p>
</li>
<li><p>比如我这里解压到了：C:\Program Files\nodejs中</p>
</li>
<li><p>然后在这个目录下新建两个文件夹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node-cache</span><br><span class="line">node-global</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>ps:这是用来放npm全局模块的安装目录，也可以放到其他地方。</p>
<h3 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h3><ul>
<li><p>编辑系统Path变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">变量名：Path</span><br><span class="line">变量值（你的安装目录）：C:\Program Files\nodejs</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑Path变量<br>新增两个条目<br>%NODE_HOME%<br>%NODE_HOME%\node-global</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">变量名：Path</span><br><span class="line">变量值（你的安装目录）：%NODE_HOME%;%NODE_HOME%\node-global</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="打开CMD，如果执行的时候报错，试着换用管理员运行"><a href="#打开CMD，如果执行的时候报错，试着换用管理员运行" class="headerlink" title="打开CMD，如果执行的时候报错，试着换用管理员运行"></a>打开CMD，如果执行的时候报错，试着换用管理员运行</h3><ul>
<li>运行下面的命令，这里的地址也是安装目录<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config set prefix &quot;C:\Program Files\nodejs\node-global&quot;</span><br><span class="line">npm config set cache &quot;C:\Program Files\nodejs\node-cache&quot;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="测试，运行下面的命令有版本出现即可"><a href="#测试，运行下面的命令有版本出现即可" class="headerlink" title="测试，运行下面的命令有版本出现即可"></a>测试，运行下面的命令有版本出现即可</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure>
<h2 id="hexo"><a href="#hexo" class="headerlink" title="hexo"></a>hexo</h2><p><a href="https://zhuanlan.zhihu.com/p/26625249" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/26625249</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/04/25/node-js安装/" data-id="cjkxlf61w000ilsd6y8fd10fk" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hexo搭建" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/23/hexo搭建/" class="article-date">
  <time datetime="2018-04-23T15:17:37.000Z" itemprop="datePublished">2018-04-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/23/hexo搭建/">hexo搭建</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="最近比较忙-暂时先放上一个连接-后续我在整理一下"><a href="#最近比较忙-暂时先放上一个连接-后续我在整理一下" class="headerlink" title="最近比较忙 暂时先放上一个连接,后续我在整理一下"></a>最近比较忙 暂时先放上一个连接,后续我在整理一下</h2><p><a href="https://www.cnblogs.com/fengxiongZz/p/7707219.html" target="_blank" rel="noopener">hexo搭建连接</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/04/23/hexo搭建/" data-id="cjkxlf61r000elsd6gwgna2va" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-cookie-session自我理解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/23/cookie-session自我理解/" class="article-date">
  <time datetime="2018-04-23T14:29:02.000Z" itemprop="datePublished">2018-04-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/23/cookie-session自我理解/">cookie_session自我理解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="cookie-和session-自我理解"><a href="#cookie-和session-自我理解" class="headerlink" title="cookie 和session 自我理解"></a>cookie 和session 自我理解</h2><p> 开始 PHP Session<br> 在您把用户信息存储到 PHP session 中之前，首先必须启动会话。<br> 注释：session_start() 函数必须位于 <html> 标签之前：<br> 存储和取回 session 变量的正确方法是使用 PHP $_SESSION 变量：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">session_start();</span><br><span class="line">// 存储 session 数据</span><br><span class="line">$_SESSION[&apos;views&apos;]=1;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></html></p>
<h4 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h4><ul>
<li><p>浏览器请求服务器上一个test.php文件</p>
</li>
<li><p>test.php执行开启session_start();</p>
</li>
<li><p>这个时候服务器给浏览器的 返回头信息中  包含着一句Set_Cookie,这句表示告诉浏览器 写一个名为PHPSESSID的cookie,并在服务器上生成一个文件,存放这个session文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Response Header</span><br><span class="line">Access-Control-Allow-Headers: DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type</span><br><span class="line">Access-Control-Allow-Methods: GET,POST,OPTIONS</span><br><span class="line">Access-Control-Allow-Origin: *</span><br><span class="line">Cache-Control: must-revalidate, no-store</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">Content-Type: image/png</span><br><span class="line">Date: Mon, 23 Apr 2018 13:00:35 GMT</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Server: nginx/1.10.2</span><br><span class="line">Set-Cookie: PHPSESSID=uorfbpp8m2prv9olfpa6vmelie; path=/==</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">X-Daa-Tunnel: hop_count=1</span><br><span class="line">X-NWS-LOG-UUID: c460b76b-08e6-4a6c-8fc0-4ffd7c0a2a8f af9b19c3b29c523d7d5bf5e81938f9cd</span><br><span class="line">X-Powered-By: PHP/7.1.4</span><br></pre></td></tr></table></figure>
</li>
<li><p>此时Cookies中便存在cookie</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Name</th>
<th style="text-align:center">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>PHPSESSID</td>
<td style="text-align:center">uorfbpp8m2prv9olfpa6vmelie</td>
</tr>
</tbody>
</table>
<ul>
<li><p>这个是浏览器每次访问服务器的时候在请求头信息中带有Cookie: PHPSESSID=uorfbpp8m2prv9olfpa6vmelie</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Request Header</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Cookie: PHPSESSID=uorfbpp8m2prv9olfpa6vmelie</span><br><span class="line">Host: test.linfiy.com</span><br><span class="line">Referer: http://test.linfiy.com/mahjong/client/backstage-cangzhou/</span><br><span class="line">User-Agent: Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Mobile Safari/537.36</span><br></pre></td></tr></table></figure>
</li>
<li><p>cookie 如果设置了有效期 setcookie(“name”,”key”,time()+3600); 同时浏览器关不清除cookie则  关闭浏览器cookie在有效期内不失效;cookie写的是过去的时间戳,不是多少秒;setcookie设置到那个时间段过期</p>
</li>
<li>ini_set(‘session.gc_maxlifetime’, “3600”); // 默认1440秒 也就是24分钟 ,多少秒有效</li>
<li>ini_set(“session.cookie_lifetime”,”3600”); // 秒</li>
<li>今天想和大家分享一个关于Session的话题: 当浏览器关闭时，Session就被销毁了？</li>
</ul>
<p>我们知道Session是JSP的九大内置对象（也叫隐含对象）中的一个，它的作用是可以保</p>
<p>存当前用户的状态信息，初学它的时候，认为Session的生命周期是从打开一个浏览器窗</p>
<p>口发送请求到关闭浏览器窗口，但其实这种说法是不正确的！下面就具体的去解释：</p>
<p>当用户第一次访问Web应用中支持Session的某个网页时，就会开始一个新的Session，</p>
<p>那么接下来当用户浏览这个Web应用的不同网页时，始终处于一个Session中</p>
<p>再详细些：</p>
<p>当一个Session开始时，Servlet容器会创建一个HttpSession对象，那么在HttpSession对象中，可以存放用户状态的信息</p>
<p>Servlet容器为HttpSession对象分配一个唯一标识符即Sessionid，Servlet容器把Sessionid作为一种Cookie保存在客户端的 <em>浏览器</em> 中</p>
<p>用户每次发出Http请求时，Servlet容器会从HttpServletRequest对象中取出Sessionid,然后根据这个Sessionid找到相应的HttpSession对象，从而获取用户的状态信息<br>以上就是Session的运行机制，但是还没有提到Session的生命周期，再往下了解！</p>
<p>其实让Session结束生命周期，有以下两种办法：</p>
<p>一个是Session.invalidate()方法，不过这个方法在实际的开发中，并不推荐，可能在强制注销用户的时候会使用；<br>一个是当前用户和服务器的交互时间超过默认时间后，Session会失效<br>我们知道Session是存在于服务器端的，当把浏览器关闭时，浏览器并没有向服务器发送</p>
<p>任何请求来关闭Session，自然Session也不会被销毁，但是可以做一点努力，在所有的</p>
<p>客户端页面里使用js的window.onclose来监视浏览器的关闭动作，然后向服务器发送一</p>
<p>个请求来关闭Session，但是这种做法在实际的开发中也是不推荐使用的，最正常的办法</p>
<p>就是不去管它，让它等到默认的时间后，自动销毁</p>
<p>那么为什么当我们关闭浏览器后，就再也访问不到之前的session了呢？</p>
<p>其实之前的Session一直都在服务器端，而当我们关闭浏览器时，此时的Cookie是存在</p>
<p>于浏览器的进程中的，当浏览器关闭时，Cookie也就不存在了。</p>
<p>其实Cookie有两种:</p>
<p>一种是存在于浏览器的进程中;<br>一种是存在于硬盘上<br>而session的Cookie是存在于浏览器的进程中，那么这种Cookie我们称为会话Cookie，</p>
<p>当我们重新打开浏览器窗口时，之前的Cookie中存放的Sessionid已经不存在了，此时</p>
<p>服务器从HttpServletRequest对象中没有检查到sessionid，服务器会再发送一个新的存</p>
<p>有Sessionid的Cookie到客户端的浏览器中，此时对应的是一个新的会话，而服务器上</p>
<p>原先的session等到它的默认时间到之后，便会自动销毁。</p>
<p>ps:</p>
<p>当在同一个浏览器中同时打开多个标签，发送同一个请求或不同的请求，仍是同一个session;</p>
<p>当不在同一个窗口中打开相同的浏览器时，发送请求，仍是同一个session;</p>
<p>当使用不同的浏览器时，发送请求，即使发送相同的请求，是不同的session;</p>
<p>当把当前某个浏览器的窗口全关闭，再打开，发起相同的请求时，就是本文所阐述的，是不同的session,但是它和session的生命周期是没有关系的.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/04/23/cookie-session自我理解/" data-id="cjkxlf61f0008lsd6s2lmvuon" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-php-iconv" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/23/php-iconv/" class="article-date">
  <time datetime="2018-04-23T14:28:43.000Z" itemprop="datePublished">2018-04-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/23/php-iconv/">php-iconv</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="PHP-mb-convert-encoding-函数-与-iconv"><a href="#PHP-mb-convert-encoding-函数-与-iconv" class="headerlink" title="PHP mb_convert_encoding()函数 与 iconv"></a>PHP mb_convert_encoding()函数 与 iconv</h2><p>函数 为php内部多字节字符串编码转换函数，可以在有需要的场合进行编码转换，如：解决<br>在GB2312编码环境下使用Ajax产生的中文 字符乱码 问题。支持几乎所有编码，版本支持 PHP 4 &gt;= 4.0.6、PHP 5。<br>mb_开头的字符串函数需要PHP开启 对应的扩展mb_string =&gt; <a href="https://blog.csdn.net/yumenshizhongjingjie/article/details/50569889" target="_blank" rel="noopener">开启方法</a></p>
<h4 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mb_convert_encoding ( string str, string to_encoding [, mixed from_encoding] )</span><br></pre></td></tr></table></figure>
<ul>
<li>string str 需要进行编码转换的字符串; </li>
<li>string to_encoding 指定转换为某种编码，如：gb2312、gbk、utf-8等;</li>
</ul>
<h4 id="1、把-GBK-编码字串转换成-UTF-8-编码字串"><a href="#1、把-GBK-编码字串转换成-UTF-8-编码字串" class="headerlink" title="1、把 GBK 编码字串转换成 UTF-8 编码字串;"></a>1、把 GBK 编码字串转换成 UTF-8 编码字串;</h4><p>Php代码 收藏代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">header(&quot;content-Type: text/html; charset=Utf-8&quot;);  </span><br><span class="line">echo mb_convert_encoding(&quot;你是我的好朋友&quot;, &quot;UTF-8&quot;, &quot;GBK&quot;);  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="2、把-UTF-8-编码字串转换成-GB2312-编码字串"><a href="#2、把-UTF-8-编码字串转换成-GB2312-编码字串" class="headerlink" title="2、把 UTF-8 编码字串转换成 GB2312 编码字串"></a>2、把 UTF-8 编码字串转换成 GB2312 编码字串</h4><p>Php代码 收藏代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 注意将此文件存盘成 utf-8 编码格式文件再测试</span><br><span class="line"></span><br><span class="line">&lt;?php  </span><br><span class="line">header(&quot;content-Type: text/html; charset=gb2312&quot;);  </span><br><span class="line">echo mb_convert_encoding(&quot;你是我的好朋友&quot;, &quot;gb312&quot;, &quot;utf-8&quot;);</span><br></pre></td></tr></table></figure></p>
<h2 id="iconv-—-字符串按要求的字符编码来转换"><a href="#iconv-—-字符串按要求的字符编码来转换" class="headerlink" title="iconv — 字符串按要求的字符编码来转换"></a>iconv — 字符串按要求的字符编码来转换</h2><h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><p>string iconv ( string $in_charset , string $out_charset , string $str )<br>将字符串 str 从 in_charset 转换编码到 out_charset。</p>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><h4 id="in-charset"><a href="#in-charset" class="headerlink" title="in_charset"></a>in_charset</h4><ul>
<li>输入的字符集。</li>
</ul>
<h4 id="out-charset"><a href="#out-charset" class="headerlink" title="out_charset"></a>out_charset</h4><ul>
<li>输出的字符集。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">如果你在 out_charset 后添加了字符串 //TRANSLIT，将启用转写（transliteration）功能。</span><br><span class="line">这个意思是，当一个字符不能被目标字符集所表示时，它可以通过一个或多个形似的字符来近似表达。</span><br><span class="line">如果你添加了字符串 //IGNORE，不能以目标字符集表达的字符将被默默丢弃。 </span><br><span class="line">否则，会导致一个 E_NOTICE并返回 FALSE。</span><br><span class="line"></span><br><span class="line">Caution</span><br><span class="line">//TRANSLIT 运行细节高度依赖于系统的 iconv() 实现（参见 ICONV_IMPL）。</span><br><span class="line">据悉，某些系统上的实现会直接忽略 //TRANSLIT，</span><br><span class="line">所以转换也有可能失败，out_charset 会是不合格的。</span><br></pre></td></tr></table></figure>
<h4 id="str"><a href="#str" class="headerlink" title="str"></a>str</h4><ul>
<li>要转换的字符串。</li>
</ul>
<h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$text = &quot;This is the Euro symbol &apos;€&apos;.&quot;;</span><br><span class="line"></span><br><span class="line">echo &apos;Original : &apos;, $text, PHP_EOL;</span><br><span class="line">echo &apos;TRANSLIT : &apos;, iconv(&quot;UTF-8&quot;, &quot;ISO-8859-1//TRANSLIT&quot;, $text), PHP_EOL;</span><br><span class="line">echo &apos;IGNORE   : &apos;, iconv(&quot;UTF-8&quot;, &quot;ISO-8859-1//IGNORE&quot;, $text), PHP_EOL;</span><br><span class="line">echo &apos;Plain    : &apos;, iconv(&quot;UTF-8&quot;, &quot;ISO-8859-1&quot;, $text), PHP_EOL;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/04/23/php-iconv/" data-id="cjkxlf61z000klsd6pnvveclz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-discuz-qq-bug" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/18/discuz-qq-bug/" class="article-date">
  <time datetime="2018-04-18T14:54:59.000Z" itemprop="datePublished">2018-04-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/18/discuz-qq-bug/">discuz_qq_bug</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="今天在工作中领导交给我一个bug"><a href="#今天在工作中领导交给我一个bug" class="headerlink" title="今天在工作中领导交给我一个bug"></a>今天在工作中领导交给我一个bug</h2><h2 id="Discuz-X3-2QQ登录出现redirect-uri-is-illegal-100010-的解决办法"><a href="#Discuz-X3-2QQ登录出现redirect-uri-is-illegal-100010-的解决办法" class="headerlink" title="Discuz! X3.2QQ登录出现redirect uri is illegal(100010)的解决办法"></a>Discuz! X3.2QQ登录出现redirect uri is illegal(100010)的解决办法</h2><p>|详解: 如果同步站点信息时使用站点URL：bbs.xxx.com，那么在其他域名如：<a href="http://www.xxx.com登录，也就是同一主域名下的其它二级域名登录，那么就会出现：redirect" target="_blank" rel="noopener">www.xxx.com登录，也就是同一主域名下的其它二级域名登录，那么就会出现：redirect</a> uri is illegal(100010)。</p>
<p>|原因是腾讯在4月末更改了QQ互联的规则，在不同的二级域名是无法通过QQ登录时的授权的。</p>
<p>|用TX的话说“就是指你的回调地址不合法”</p>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><ul>
<li>打开：source\plugin\qqconnect\connect.class.php</li>
<li>找到</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_G[&apos;siteurl&apos;]    //获取当前域名</span><br></pre></td></tr></table></figure>
<p>修改为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://你的网站/</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/04/18/discuz-qq-bug/" data-id="cjkxlf61a0005lsd6s82t6ab9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-php-strlen" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/17/php-strlen/" class="article-date">
  <time datetime="2018-04-17T14:52:55.000Z" itemprop="datePublished">2018-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/17/php-strlen/">PHP-strlen</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="strlen-与-mb-strlen区别-面试经常被问到"><a href="#strlen-与-mb-strlen区别-面试经常被问到" class="headerlink" title="strlen 与 mb_strlen区别  面试经常被问到"></a>strlen 与 mb_strlen区别  面试经常被问到</h2><h4 id="在PHP里有两个计算字符串个数的函数"><a href="#在PHP里有两个计算字符串个数的函数" class="headerlink" title="在PHP里有两个计算字符串个数的函数"></a>在PHP里有两个计算字符串个数的函数</h4><p>一个是 strlen,一个是mb_strlen;<br>先来看看手册中的定义</p>
<ul>
<li>strlen</li>
<li>strlen — 获取字符串长度</li>
<li>int strlen ( string $string )<br>返回给定的字符串 string 的长度。</li>
<li>mb_strlen</li>
<li>int mb_strlen ( string $str [, string $encoding ] )</li>
<li>返回给定的字符串 string 的长度。</li>
</ul>
<p>encoding参数为字符编码。如果省略，则使用内部字符编码。<br>这么看除了mb_strlen可以传递一个字符编码好像没有其他区别，下面通过例子，讲解这两者之间的区别。<br>先看例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php    //测试时文件的编码方式要是UTF8    </span><br><span class="line">$str=&apos;中文a字1符&apos;;    </span><br><span class="line">echo strlen($str).&apos;&lt;br&gt;&apos;;//14    字节 中文*3</span><br><span class="line">echo mb_strlen($str,&apos;utf8&apos;).&apos;&lt;br&gt;&apos;;//6 字符个数,中文也算1</span><br><span class="line">echo mb_strlen($str,&apos;gbk&apos;).&apos;&lt;br&gt;&apos;;//8  一个中文1.5个字符</span><br><span class="line">echo mb_strlen($str,&apos;gb2312&apos;).&apos;&lt;br&gt;&apos;;//10 一个中文2个字符??待却定</span><br></pre></td></tr></table></figure></p>
<p>结果分析：在strlen计算时，对待一个UTF8的中文字符是3个长度，所以“中文a字1符”长度是3*4+2=14,在mb_strlen计算时，选定内码为UTF8，则会将一个中文字符当作长度1来计算，所以“中文a字1符”长度是6 </p>
<hr>
<p>ps:</p>
<h4 id="采用mb-strlen函数可以较好地解决这个问题。mb-strlen的用法和-strlen类似，只不过它有第二个可选参数用于指定字符编码。例如得到UTF-8的字符串-str长度，可以用-mb-strlen-str-’UTF-8’-。如果省略第二个参数，则会使用PHP的内部编码。内部编码可以通过-mb-internal-encoding-函数得到。"><a href="#采用mb-strlen函数可以较好地解决这个问题。mb-strlen的用法和-strlen类似，只不过它有第二个可选参数用于指定字符编码。例如得到UTF-8的字符串-str长度，可以用-mb-strlen-str-’UTF-8’-。如果省略第二个参数，则会使用PHP的内部编码。内部编码可以通过-mb-internal-encoding-函数得到。" class="headerlink" title="采用mb_strlen函数可以较好地解决这个问题。mb_strlen的用法和 strlen类似，只不过它有第二个可选参数用于指定字符编码。例如得到UTF-8的字符串$str长度，可以用 mb_strlen($str,’UTF-8’)。如果省略第二个参数，则会使用PHP的内部编码。内部编码可以通过 mb_internal_encoding()函数得到。"></a>采用mb_strlen函数可以较好地解决这个问题。mb_strlen的用法和 strlen类似，只不过它有第二个可选参数用于指定字符编码。例如得到UTF-8的字符串$str长度，可以用 mb_strlen($str,’UTF-8’)。如果省略第二个参数，则会使用PHP的内部编码。内部编码可以通过 mb_internal_encoding()函数得到。</h4><h4 id="需要注意的是，mb-strlen并不是PHP核心函数，Windows-下使用前需要确保在php-ini中加载了php-mbstring-dll，即确保“extension-php-mbstring-dll”这一行存在并且没有被注释掉，否则会出现未定义函数的问题。Linux-下需要编译这个扩展。"><a href="#需要注意的是，mb-strlen并不是PHP核心函数，Windows-下使用前需要确保在php-ini中加载了php-mbstring-dll，即确保“extension-php-mbstring-dll”这一行存在并且没有被注释掉，否则会出现未定义函数的问题。Linux-下需要编译这个扩展。" class="headerlink" title="需要注意的是，mb_strlen并不是PHP核心函数，Windows 下使用前需要确保在php.ini中加载了php_mbstring.dll，即确保“extension=php_mbstring.dll”这一行存在并且没有被注释掉，否则会出现未定义函数的问题。Linux 下需要编译这个扩展。"></a>需要注意的是，mb_strlen并不是PHP核心函数，Windows 下使用前需要确保在php.ini中加载了php_mbstring.dll，即确保“extension=php_mbstring.dll”这一行存在并且没有被注释掉，否则会出现未定义函数的问题。Linux 下需要编译这个扩展。</h4>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/04/17/php-strlen/" data-id="cjkxlf620000llsd6bvrs7s72" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ddos攻击防御" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/16/ddos攻击防御/" class="article-date">
  <time datetime="2018-04-16T14:29:45.000Z" itemprop="datePublished">2018-04-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/16/ddos攻击防御/">ddos攻击防御</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1、安装DDoS-deflate"><a href="#1、安装DDoS-deflate" class="headerlink" title="1、安装DDoS deflate"></a>1、安装DDoS deflate</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /root</span><br><span class="line">wget http://www.inetbase.com/scripts/ddos/install.sh   //下载DDoS deflate</span><br><span class="line">chmod 0700 install.sh      //添加权限</span><br><span class="line">sh install.sh        //执行</span><br></pre></td></tr></table></figure>
<h2 id="2、配置DDoS-deflate下面是DDoS-deflate的默认配置位于-usr-local-ddos-ddos-conf-，内容如下："><a href="#2、配置DDoS-deflate下面是DDoS-deflate的默认配置位于-usr-local-ddos-ddos-conf-，内容如下：" class="headerlink" title="2、配置DDoS deflate下面是DDoS deflate的默认配置位于/usr/local/ddos/ddos.conf ，内容如下："></a>2、配置DDoS deflate下面是DDoS deflate的默认配置位于/usr/local/ddos/ddos.conf ，内容如下：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd  /usr/local/ddos</span><br><span class="line">vim ddos.conf</span><br></pre></td></tr></table></figure>
<h2 id="默认配置"><a href="#默认配置" class="headerlink" title="默认配置"></a>默认配置</h2><h5 id="Paths-of-the-script-and-other-files"><a href="#Paths-of-the-script-and-other-files" class="headerlink" title="Paths of the script and other files"></a>Paths of the script and other files</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PROGDIR=&quot;/usr/local/ddos&quot;</span><br><span class="line">PROG=&quot;/usr/local/ddos/ddos.sh&quot;</span><br><span class="line">IGNORE_IP_LIST=&quot;/usr/local/ddos/ignore.ip.list&quot;  //IP地址白名单 </span><br><span class="line">CRON=&quot;/etc/cron.d/ddos.cron&quot;    //定时执行程序 </span><br><span class="line">APF=&quot;/etc/apf/apf&quot;</span><br><span class="line">IPT=&quot;/sbin/iptables&quot; </span><br><span class="line">##### frequency in minutes for running the script</span><br><span class="line">##### Caution: Every time this setting is changed, run the script with --cron</span><br><span class="line">#####            option so that the new frequency takes effect</span><br><span class="line">FREQ=1   //检查时间间隔，默认1分钟 </span><br><span class="line">##### How many connections define a bad IP? Indicate that below.</span><br><span class="line">NO_OF_CONNECTIONS=50     //最大连接数，超过这个数IP就会被屏蔽，一般默认即可 </span><br><span class="line">##### APF_BAN=1 (Make sure your APF version is atleast 0.96)</span><br><span class="line">##### APF_BAN=0 (Uses iptables for banning ips instead of APF)</span><br><span class="line">APF_BAN=0        //使用APF还是iptables。推荐使用iptables,将APF_BAN的值改为0即可。 </span><br><span class="line">##### KILL=0 (Bad IPs are&apos;nt banned, good for interactive execution of script)</span><br><span class="line">##### KILL=1 (Recommended setting)</span><br><span class="line">KILL=1   //是否屏蔽IP，默认即可 </span><br><span class="line">##### An email is sent to the following address when an IP is banned.</span><br><span class="line">##### Blank would suppress sending of mails</span><br><span class="line">EMAIL_TO=&quot;root&quot;   //当IP被屏蔽时给指定邮箱发送邮件，推荐使用，换成自己的邮箱即可 </span><br><span class="line">##### Number of seconds the banned ip should remain in blacklist.</span><br><span class="line">BAN_PERIOD=6000    //禁用IP时间，默认6000秒，可根据情况调整</span><br></pre></td></tr></table></figure>
<h2 id="3-修改配置-问题"><a href="#3-修改配置-问题" class="headerlink" title="3 修改配置 问题"></a>3 修改配置 问题</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim ddos.sh </span><br><span class="line">1，ip地址过滤的不够细致</span><br><span class="line">在117行，更还此段代码为：</span><br><span class="line">netstat -ntu | awk &apos;&#123;print $5&#125;&apos; | egrep -o &quot;[0-9]&#123;1,3&#125;.[0-9]&#123;1,3&#125;.[0-9]&#123;1,3&#125;.[0-9]&#123;1,3&#125;&quot; | sort | uniq -c | sort -nr &gt; $BAD_IP_LIST</span><br><span class="line"></span><br><span class="line">2，注释掉134行：</span><br><span class="line">echo $CURR_LINE_IP &gt;&gt; $IGNORE_IP_LIST</span><br></pre></td></tr></table></figure>
<h2 id="4-按照配置文件创建一个执行计划"><a href="#4-按照配置文件创建一个执行计划" class="headerlink" title="4 按照配置文件创建一个执行计划"></a>4 按照配置文件创建一个执行计划</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/ddos/ddos.sh -c    //按照配置文件创建一个执行计划</span><br><span class="line">http://blog.chinaunix.net/uid-10449864-id-3300661.html</span><br><span class="line">http://czmmiao.iteye.com/blog/1616837</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/tangchunxin/tangchunxin.github.io/2018/04/16/ddos攻击防御/" data-id="cjkxlf6190004lsd6ouxygz6m" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/08/17/git常用命令/">git常用命令</a>
          </li>
        
          <li>
            <a href="/2018/08/17/es搜索-must-should联合查询/">es搜索 must should联合查询</a>
          </li>
        
          <li>
            <a href="/2018/08/17/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2018/08/16/git-start/">git start</a>
          </li>
        
          <li>
            <a href="/2018/05/20/正则-手机号中间4位变成/">正则 手机号中间4位变成*</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Tangchunxin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>